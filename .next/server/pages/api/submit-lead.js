"use strict";(()=>{var e={};e.id=618,e.ids=[618],e.modules={3480:(e,t,o)=>{e.exports=o(5600)},5600:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6435:(e,t)=>{Object.defineProperty(t,"M",{enumerable:!0,get:function(){return function e(t,o){return o in t?t[o]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,o)):"function"==typeof t&&"default"===o?t:void 0}}})},7838:(e,t,o)=>{o.r(t),o.d(t,{config:()=>p,default:()=>h,routeModule:()=>f});var r={};o.r(r),o.d(r,{default:()=>m});var n=o(3480),a=o(8667),s=o(6435);let i=require("nodemailer");var u=o.n(i);let c=process.env.ZOHO_API_BASE||"https://www.zohoapis.com";async function l(){let e=new URLSearchParams({grant_type:"refresh_token",client_id:process.env.ZOHO_CLIENT_ID,client_secret:process.env.ZOHO_CLIENT_SECRET,refresh_token:process.env.ZOHO_REFRESH_TOKEN}),t=await fetch(`https://accounts.zoho.com/oauth/v2/token?${e}`,{method:"POST"});if(!t.ok)throw console.error("[Zoho OAuth Error]",await t.text()),Error("Failed to refresh Zoho access token");let{access_token:o}=await t.json();return o}async function d(e,t){let o={data:[{Last_Name:t.name||"Unknown",Company:t.businessName||"",Email:t.email||"",Mobile:t.phone||"",unique_id1:t.uniqueId||"",Contact_Us_Page_Name:"B2B Page"}]},r=await fetch(`${c}/crm/v2/Leads`,{method:"POST",headers:{Authorization:`Zoho-oauthtoken ${e}`,"Content-Type":"application/json"},body:JSON.stringify(o)});if(!r.ok)throw console.error("[Zoho CRM Error]",await r.text()),Error("Zoho CRM lead creation failed");return r.json()}async function m(e,t){if("POST"!==e.method)return t.status(405).json({message:"Only POST allowed"});let o=e.body;try{let e=await fetch(process.env.GS,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...o,action:"submit-lead"})});if(!e.ok)throw console.error("[Sheets Error]",await e.text()),Error("Failed to log to Sheets")}catch(e){return t.status(500).json({message:e.message})}try{let e=await l();await d(e,o)}catch(e){return t.status(500).json({message:e.message})}try{let e=u().createTransport({host:"smtp.gmail.com",port:587,secure:!1,auth:{user:process.env.EMAIL_USER,pass:process.env.EMAIL_PASS}});await e.sendMail({from:`Olio B2B <${process.env.EMAIL_USER}>`,to:"olioclientwebsiteleads@gmail.com",subject:"\uD83D\uDCE3 New Lead from Olio B2B",text:`Name: ${o.name}
Email: ${o.email}
Phone: ${o.phone}
Business: ${o.businessName}
Unique ID: ${o.uniqueId}`})}catch(e){console.error("[Email Error]",e)}return t.status(200).json({success:!0,id:o.uniqueId})}let h=(0,s.M)(r,"default"),p=(0,s.M)(r,"config"),f=new n.PagesAPIRouteModule({definition:{kind:a.A.PAGES_API,page:"/api/submit-lead",pathname:"/api/submit-lead",bundlePath:"",filename:""},userland:r})},8667:(e,t)=>{Object.defineProperty(t,"A",{enumerable:!0,get:function(){return o}});var o=function(e){return e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE",e.IMAGE="IMAGE",e}({})}};var t=require("../../webpack-api-runtime.js");t.C(e);var o=t(t.s=7838);module.exports=o})();
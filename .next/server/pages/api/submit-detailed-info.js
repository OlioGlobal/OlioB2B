"use strict";(()=>{var e={};e.id=137,e.ids=[137],e.modules={3480:(e,o,t)=>{e.exports=t(5600)},4161:(e,o,t)=>{t.r(o),t.d(o,{config:()=>f,default:()=>h,routeModule:()=>g});var n={};t.r(n),t.d(n,{default:()=>l});var a=t(3480),r=t(8667),s=t(6435);let i=process.env.ZOHO_API_BASE||"https://www.zohoapis.com";async function d(){console.log("[Zoho] Fetching access tokenâ€¦");let e=new URLSearchParams({grant_type:"refresh_token",client_id:process.env.ZOHO_CLIENT_ID,client_secret:process.env.ZOHO_CLIENT_SECRET,refresh_token:process.env.ZOHO_REFRESH_TOKEN}),o=await fetch(`https://accounts.zoho.com/oauth/v2/token?${e}`,{method:"POST"});if(!o.ok)throw console.error("[Zoho OAuth Error]",await o.text()),Error("Failed to refresh Zoho access token");let{access_token:t}=await o.json();return console.log("[Zoho] Got access token"),t}async function u(e,o){console.log(`[Zoho] Searching for Lead with Unique_ID == ${o}`);let t=encodeURIComponent(`(unique_id1:equals:${o})`),n=`${i}/crm/v2/Leads/search?criteria=${t}`,a=await fetch(n,{headers:{Authorization:`Zoho-oauthtoken ${e}`}});if(!a.ok)throw console.error("[Zoho Update Error]",await a.text()),Error("Failed to update Zoho Lead");let r=await a.json(),s=r.data?.[0]||null;return console.log(s?`[Zoho] Found existing Lead (id=${s.id})`:"[Zoho] No Lead found for that Unique_ID"),s}async function c(e,o,t){console.log(`[Zoho] Updating Lead ${o} with new details`);let n={data:[{id:o,Website_URL:t.websiteUrl,Urgency_Level:t.urgency,Challenges:t.challenges}]},a=await fetch(`${i}/crm/v2/Leads`,{method:"PUT",headers:{Authorization:`Zoho-oauthtoken ${e}`,"Content-Type":"application/json"},body:JSON.stringify(n)});if(!a.ok)throw console.error("[Zoho Update Error]",await a.text()),Error("Failed to update Zoho Lead");let r=await a.json();return console.log("[Zoho] Update successful:",r),r}async function l(e,o){let t,n;if("POST"!==e.method)return console.log("[API] Bad method:",e.method),o.status(405).json({message:"Only POST allowed"});console.log("[API] Payload received:",e.body);let a=e.body;try{t=await d()}catch(e){return o.status(500).json({message:e.message})}try{n=await u(t,a.uniqueId)}catch(e){return o.status(500).json({message:e.message})}if(!n)return console.warn(`[API] No existing lead for uniqueId=${a.uniqueId}`),o.status(404).json({message:"Lead not found"});try{await c(t,n.id,a)}catch(e){return o.status(500).json({message:e.message})}return console.log("[API] Done updating lead."),o.status(200).json({success:!0,id:n.id})}let h=(0,s.M)(n,"default"),f=(0,s.M)(n,"config"),g=new a.PagesAPIRouteModule({definition:{kind:r.A.PAGES_API,page:"/api/submit-detailed-info",pathname:"/api/submit-detailed-info",bundlePath:"",filename:""},userland:n})},5600:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6435:(e,o)=>{Object.defineProperty(o,"M",{enumerable:!0,get:function(){return function e(o,t){return t in o?o[t]:"then"in o&&"function"==typeof o.then?o.then(o=>e(o,t)):"function"==typeof o&&"default"===t?o:void 0}}})},8667:(e,o)=>{Object.defineProperty(o,"A",{enumerable:!0,get:function(){return t}});var t=function(e){return e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE",e.IMAGE="IMAGE",e}({})}};var o=require("../../webpack-api-runtime.js");o.C(e);var t=o(o.s=4161);module.exports=t})();